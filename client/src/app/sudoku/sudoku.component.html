<div class="sudoku-container">
    <app-header></app-header>
    <div class="resume-overlay" *ngIf="showResumePrompt" aria-hidden="true"></div>
    <div
      class="resume-modal"
      *ngIf="showResumePrompt"
      role="dialog"
      aria-modal="true"
      aria-label="Resume saved game">
      <div class="resume-title">Resume game?</div>
      <p class="resume-copy">
        We found a saved puzzle. Pick up where you left off or start a fresh board.
      </p>
      <div class="resume-actions">
        <button
          type="button"
          class="ghost-button"
          (click)="startNewGame()">
          Start New
        </button>
        <button
          type="button"
          (click)="resumeSavedGame()">
          Resume
        </button>
      </div>
    </div>
    <div class="timer-bar">
      <div class="timer-display">
        <span class="timer-label">Time</span>
        <span class="timer-value">{{ formatTime() }}</span>
        <button
          class="timer-toggle"
          type="button"
          (click)="toggleTimer()"
          [disabled]="isCompleted"
          [attr.aria-label]="isPaused ? 'Resume timer' : 'Pause timer'">
          <span *ngIf="isPaused">&#9658;</span>
          <span *ngIf="!isPaused">&#10074;&#10074;</span>
        </button>
      </div>
      <button
        class="stats-button"
        type="button"
        (click)="toggleStats()"
        [attr.aria-expanded]="showStats"
        aria-label="View stats">
        <svg aria-hidden="true" viewBox="0 0 24 24">
          <path d="M4 19h16v2H4zM6 10h3v7H6zm5-5h3v12h-3zm5 8h3v4h-3z"/>
        </svg>
        <span class="sr-only">Stats</span>
      </button>
    </div>
    <div class="stats-overlay" *ngIf="showStats" (click)="toggleStats()" aria-hidden="true"></div>
    <div
      class="stats-modal"
      *ngIf="showStats"
      role="dialog"
      aria-modal="true"
      aria-label="Stats">
      <div class="stats-header">
        <div class="stats-title">Stats</div>
        <button
          class="close-stats"
          type="button"
          (click)="toggleStats()"
          aria-label="Close stats">
          &times;
        </button>
      </div>
      <div class="stats-grid">
        <div class="stats-row" *ngFor="let stat of statsViewOrder">
          <div class="difficulty-label">{{ stat.label }}</div>
          <div class="stat-block">
            <span class="stat-label">Completed</span>
            <span class="stat-value">{{ stats[stat.key].gamesCompleted }}</span>
          </div>
          <div class="stat-block">
            <span class="stat-label">Fastest</span>
            <span class="stat-value">{{ formatSeconds(stats[stat.key].fastestTime) }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="user-message" *ngIf="userMessage">{{ userMessage }}</div>
    <div class="grid-wrapper">
      <app-grid
        [puzzle]="puzzle"
        [userInput]="userInput"
        [incorrectCells]="incorrectCells"
        [incorrectRows]="incorrectRows"
        [incorrectCols]="incorrectCols"
        [incorrectBoxes]="incorrectBoxes"
        [highlightErrors]="highlightErrors"
        [isPaused]="isPaused"
        (cellChange)="onCellInputChange()">
      </app-grid>
      <button 
        *ngIf="isPaused"
        type="button"
        class="board-resume"
        (click)="resumeTimer()"
        aria-label="Resume game">
      </button>
    </div>
    <div class="controls-container">
        <button id="check-solution-button" (click)="checkSolution()">Check Solution</button>
        <button id="clear-input-button" (click)="clearUserInput()">Clear Input</button>
        <button id="toggle-highlight-button" (click)="toggleHighlighting()">
            {{ highlightErrors ? 'Disable Highlighting' : 'Enable Highlighting' }}
        </button>
        <select id="difficulty" [(ngModel)]="difficulty" (change)="onDifficultyChange($event)">
            <option *ngFor="let level of difficultyLevels" [value]="level.value">
                {{ level.label }}
            </option>
        </select>
    </div>
</div>
